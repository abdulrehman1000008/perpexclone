/**
 * Browser-Specific Fixes and Fallbacks
 * This file contains CSS fixes for cross-browser compatibility issues
 */

/* ==========================================================================
   Internet Explorer 11 Fixes
   ========================================================================== */

@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {
  /* IE11 CSS Grid fallback */
  .grid-container {
    display: flex;
    flex-wrap: wrap;
  }
  
  .grid-item {
    flex: 1 1 300px;
    margin: 0.5rem;
  }
  
  /* IE11 flexbox fallback for older flexbox syntax */
  .flex-container {
    display: -ms-flexbox;
    -ms-flex-direction: row;
    -ms-flex-wrap: wrap;
  }
  
  .flex-item {
    -ms-flex: 1 1 auto;
  }
  
  /* IE11 CSS custom properties fallback */
  :root {
    --primary-color: #3b82f6;
    --secondary-color: #64748b;
    --accent-color: #f59e0b;
    --background-color: #ffffff;
    --text-color: #1f2937;
    --border-color: #e5e7eb;
    --shadow-color: rgba(0, 0, 0, 0.1);
  }
  
  /* IE11 specific color overrides */
  .bg-primary { background-color: #3b82f6 !important; }
  .bg-secondary { background-color: #64748b !important; }
  .bg-accent { background-color: #f59e0b !important; }
  .bg-background { background-color: #ffffff !important; }
  .text-primary { color: #3b82f6 !important; }
  .text-secondary { color: #64748b !important; }
  .text-accent { color: #f59e0b !important; }
  .text-background { color: #1f2937 !important; }
  .border-primary { border-color: #e5e7eb !important; }
  .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.1) !important; }
  .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1) !important; }
  .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1) !important; }
}

/* ==========================================================================
   Safari Fixes
   ========================================================================== */

/* Safari-specific webkit prefixes */
@supports (-webkit-appearance: none) {
  /* Fix for Safari flexbox issues */
  .safari-flex-fix {
    -webkit-flex-shrink: 0;
    flex-shrink: 0;
  }
  
  /* Safari-specific animation fixes */
  .safari-animation-fix {
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
  }
  
  /* Fix for Safari sticky positioning */
  .safari-sticky-fix {
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
  }
}

/* Safari 10+ specific fixes */
@media screen and (-webkit-min-device-pixel-ratio: 0) {
  _::-webkit-:not(html:root), .safari-only {
    /* Safari-only styles */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}

/* ==========================================================================
   Firefox Fixes
   ========================================================================== */

/* Firefox-specific fixes */
@-moz-document url-prefix() {
  /* Fix for Firefox flexbox issues */
  .firefox-flex-fix {
    min-height: 0;
    min-width: 0;
  }
  
  /* Fix for Firefox button styling */
  .firefox-button-fix {
    -moz-appearance: none;
    appearance: none;
  }
  
  /* Fix for Firefox input styling */
  .firefox-input-fix {
    -moz-appearance: none;
    appearance: none;
  }
  
  /* Fix for Firefox scrollbar styling */
  .firefox-scrollbar-fix {
    scrollbar-width: thin;
    scrollbar-color: #cbd5e1 #f1f5f9;
  }
}

/* ==========================================================================
   Edge Fixes
   ========================================================================== */

/* Edge-specific fixes */
@supports (-ms-ime-align: auto) {
  /* Fix for Edge flexbox issues */
  .edge-flex-fix {
    min-height: 0;
    min-width: 0;
  }
  
  /* Fix for Edge CSS Grid issues */
  .edge-grid-fix {
    display: -ms-grid;
    -ms-grid-columns: 1fr 1fr 1fr;
    -ms-grid-rows: auto;
  }
}

/* ==========================================================================
   Mobile Browser Fixes
   ========================================================================== */

/* iOS Safari specific fixes */
@supports (-webkit-touch-callout: none) {
  /* Fix for iOS Safari viewport issues */
  .ios-safari-fix {
    -webkit-overflow-scrolling: touch;
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
  }
  
  /* Fix for iOS Safari input zoom */
  .ios-input-fix {
    font-size: 16px;
  }
  
  /* Fix for iOS Safari button tap highlight */
  .ios-button-fix {
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
  }
}

/* Android Chrome specific fixes */
@supports (-webkit-appearance: none) and (not (overflow: -webkit-marquee)) {
  .android-chrome-fix {
    /* Fix for Android Chrome rendering issues */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
  }
}

/* ==========================================================================
   High DPI Display Fixes
   ========================================================================== */

/* High DPI display optimizations */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  /* Optimize images for high DPI displays */
  .high-dpi-image {
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
  }
  
  /* Optimize text rendering for high DPI */
  .high-dpi-text {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
  }
}

/* ==========================================================================
   Print Styles
   ========================================================================== */

@media print {
  /* Hide non-essential elements when printing */
  .no-print {
    display: none !important;
  }
  
  /* Ensure proper page breaks */
  .page-break {
    page-break-before: always;
  }
  
  /* Optimize colors for printing */
  * {
    color: #000 !important;
    background: #fff !important;
  }
  
  /* Ensure links are visible */
  a[href]:after {
    content: " (" attr(href) ")";
  }
}

/* ==========================================================================
   Reduced Motion Support
   ========================================================================== */

@media (prefers-reduced-motion: reduce) {
  /* Disable animations for users who prefer reduced motion */
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  /* Provide alternative visual feedback */
  .reduced-motion-feedback {
    border: 2px solid transparent;
  }
  
  .reduced-motion-feedback:focus {
    border-color: #3b82f6;
  }
}

/* ==========================================================================
   High Contrast Mode Support
   ========================================================================== */

@media (prefers-contrast: high) {
  /* Enhance contrast for high contrast mode users */
  .high-contrast-fix {
    border: 2px solid currentColor;
    background-color: transparent;
  }
  
  /* Ensure text is readable */
  .high-contrast-text {
    color: #000000;
    background-color: #ffffff;
  }
  
  /* Enhance focus indicators */
  .high-contrast-focus:focus {
    outline: 3px solid #000000;
    outline-offset: 2px;
  }
}

/* ==========================================================================
   Dark Mode Support
   ========================================================================== */

@media (prefers-color-scheme: dark) {
  /* Dark mode overrides for browsers that support it */
  .dark-mode-fallback {
    background-color: #1f2937;
    color: #f9fafb;
  }
  
  .dark-mode-fallback .border {
    border-color: #374151;
  }
  
  .dark-mode-fallback .shadow {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
  }
}

/* ==========================================================================
   Focus Management
   ========================================================================== */

/* Ensure focus indicators are visible */
.focus-visible:focus {
  outline: 2px solid #3b82f6;
  outline-offset: 2px;
}

/* Hide focus indicators for mouse users */
.focus-visible:focus:not(:focus-visible) {
  outline: none;
}

/* ==========================================================================
   Touch Device Optimizations
   ========================================================================== */

/* Optimize for touch devices */
@media (pointer: coarse) {
  /* Ensure touch targets are large enough */
  .touch-target {
    min-height: 44px;
    min-width: 44px;
  }
  
  /* Optimize hover states for touch */
  .touch-hover {
    /* Disable hover effects on touch devices */
  }
  
  .touch-hover:hover {
    /* Reset hover styles for touch devices */
  }
}

/* ==========================================================================
   Legacy Browser Fallbacks
   ========================================================================== */

/* Fallback for browsers that don't support CSS Grid */
@supports not (display: grid) {
  .grid-fallback {
    display: flex;
    flex-wrap: wrap;
  }
  
  .grid-item-fallback {
    flex: 1 1 300px;
    margin: 0.5rem;
  }
}

/* Fallback for browsers that don't support CSS Custom Properties */
@supports not (--custom-property: value) {
  .custom-property-fallback {
    background-color: #3b82f6;
    color: #ffffff;
    border-color: #e5e7eb;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
  }
}

/* Fallback for browsers that don't support CSS Flexbox */
@supports not (display: flex) {
  .flexbox-fallback {
    display: block;
  }
  
  .flex-item-fallback {
    display: inline-block;
    vertical-align: top;
    width: 100%;
  }
}

/* ==========================================================================
   Performance Optimizations
   ========================================================================== */

/* Optimize animations for better performance */
.performance-optimized {
  will-change: transform, opacity;
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* Optimize scrolling performance */
.smooth-scroll {
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
}

/* Optimize rendering performance */
.render-optimized {
  contain: layout, style, paint;
  isolation: isolate;
}

/* ==========================================================================
   Accessibility Enhancements
   ========================================================================== */

/* Ensure sufficient color contrast */
.accessibility-enhanced {
  /* These colors meet WCAG AA contrast requirements */
  color: #1f2937;
  background-color: #ffffff;
  border-color: #6b7280;
}

/* Enhanced focus indicators */
.accessibility-focus:focus {
  outline: 3px solid #3b82f6;
  outline-offset: 2px;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
}

/* Screen reader only content */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* ==========================================================================
   Utility Classes
   ========================================================================== */

/* Browser detection utilities */
.browser-chrome { /* Chrome-specific styles */ }
.browser-firefox { /* Firefox-specific styles */ }
.browser-safari { /* Safari-specific styles */ }
.browser-edge { /* Edge-specific styles */ }
.browser-ie { /* Internet Explorer-specific styles */ }

/* Device detection utilities */
.device-mobile { /* Mobile device styles */ }
.device-tablet { /* Tablet device styles */ }
.device-desktop { /* Desktop device styles */ }

/* Feature detection utilities */
.feature-grid { /* CSS Grid support styles */ }
.feature-flexbox { /* Flexbox support styles */ }
.feature-custom-properties { /* CSS Custom Properties support styles */ }
.feature-animations { /* CSS Animations support styles */ }

/* ==========================================================================
   Debug and Development
   ========================================================================== */

/* Debug outlines for development */
.debug * {
  outline: 1px solid red;
}

.debug .grid * {
  outline: 1px solid blue;
}

.debug .flex * {
  outline: 1px solid green;
}

/* Browser information display */
.browser-info::before {
  content: "Browser: " attr(data-browser) " v" attr(data-version);
  display: block;
  padding: 0.5rem;
  background-color: #f3f4f6;
  border: 1px solid #d1d5db;
  border-radius: 0.375rem;
  font-family: monospace;
  font-size: 0.875rem;
}
